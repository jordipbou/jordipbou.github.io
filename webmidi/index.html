<!doctype html>
<html>
<head>
	<script src="https://unpkg.com/rxjs/bundles/rxjs.umd.min.js"></script>
	<script src="https://unpkg.com/vue/dist/vue.js"></script>
	<!-- vue-rx -->

	<script>
		function onMIDIsuccess(midiAccess) {
			let ainit = document.querySelector('.midi-initializer')
			let ports = document.querySelector('.midi-ports')
			ainit.className = 'hidden'
			ports.className = ports.className.replace(' hidden', '')

			midiAccess.onstatechange = function(e) {
			}

			// For testing, use first input
			console.log(midiAccess.inputs)
			for (let input of midiAccess.inputs.values()) {
				console.log(input)
				input.onmidimessage = function(data) {
					console.log(data)
				}
			}
		}

		function onMIDIfailure(msg) {
			console.log('Your browser does NOT support Web MIDI')
		}


		//const { range } = rxjs;
		//const { map, filter } = rxjs.operators;

		//range(1, 200).pipe(
		//	filter(x => x % 2 === 1),
		//	map(x => x + x)
		//).subscribe(x => console.log(x));
		window.onload = function() {
			let init = document.querySelector('.midi-initializer')

			init.onclick = function() {
				if (window.navigator &&
					typeof 
						navigator.requestMIDIAccess === 'function') {
					navigator
						.requestMIDIAccess()
						.then(onMIDIsuccess, onMIDIfailure);
				} else {
					onMIDIfailure('')
				}

				return false
			}
		}
	</script>
	
	<style>
		.hidden {
			display: none;
		}

		.btn {
			padding: 5px;
			border-radius: 5px;
			text-decoration: none;
		}

		.midi-initializer {
			background-color: gray;
			color: white;
			width: 100vw;
			display: block;
			text-align: center;
		}

		.midi-ports {
			display: flex;
			flex-direction: row;
		}

		.input-ports .output-ports {
			display: flex;
			flex-direction: column;
		}
	</style>
</head>
<body>
	<div class="midi-setup">
		<a class="midi-initializer btn" href="javascript:void(0);">
			Initialize Web MIDI
		</a>
		<div class="midi-ports hidden">
			<div class="input-ports">
			</div>
			<div class="output-ports">
			</div>
		</div>
	</div>
</body>
</html>
